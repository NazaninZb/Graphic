<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fruit Ninja</title>
    <script type="text/javascript" src="lib/three.js"></script>
    <script type="text/javascript" src="lib/Tween.js"></script>
    <script type="text/javascript" src="lib/ShadowMapViewer.js"></script>
    <script type="text/javascript" src="lib/dat.gui.min.js"></script>
    <script type="text/javascript" src="lib/OBJLoader.js"></script>
    <script type="text/javascript" src="lib/MTLLoader.js"></script>
    <script type="text/javascript" src="lib/GLTFLoader.js"></script>
    <script type="text/javascript" src="lib/GPUParticleSystem.js"></script>

    <style>
        body{
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div id="WebGl-output"></div>
</body>
<script type="text/javascript">
    var scene, renderer, camera;
    var backGround;
    var active_texture;

    //light variables
    var pointLight1, pointLight2, pointLight3, pointLight4;

    var dragon_texture,
        wood_texture,
        bambo_texture,
        brick_texture,
        cracked_texture,
        egypt_texture;

    // assigning textures variables
    {
        dragon_texture = new THREE.TextureLoader().load("resources/DragonYingYung.png");
        wood_texture = new THREE.TextureLoader().load("resources/Wood.png");
        bambo_texture = new THREE.TextureLoader().load("resources/Bamboo.jpg");
        brick_texture = new THREE.TextureLoader().load("resources/Brick.jpg");
        cracked_texture = new THREE.TextureLoader().load("resources/Cracked.jpg");
        egypt_texture = new THREE.TextureLoader().load("resources/Hieroglyphics.jpg");
    }


    init();
    animate();
    createPanel();
    function init() {
        // renderer initialization
        {
            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setClearColor(new THREE.Color(0xcccccc));
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        }

        // assign scene
        scene = new THREE.Scene();

        // camera setting
        {
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.01, 1000);
            camera.position.set(0, 0.286, -10.246);
            camera.rotation.set(180, 0, 180);
            camera.scale.set(0.508, 0.512, 1);
            camera.lookAt(scene.position);
        }

        // lights
        {
            // a white and smooth ambient color
            var ambiColor = "#ffffff";
            let ambientLight = new THREE.AmbientLight(ambiColor, 0.5);
            scene.add(ambientLight);


            // main light in the scene which can cast shadow
            let spotLight = new THREE.SpotLight(0xffffff);
            spotLight.position.set(0.687, -2.871, -27.974);
            spotLight.intensity = 2;
            spotLight.distance = 50;
            spotLight.angle = 0.494;
            spotLight.penumbra = 0.3;
            spotLight.castShadow = true;
            spotLight.shadow.camera.near = 8;
            spotLight.shadow.camera.far = 30;
            spotLight.shadow.mapSize.width = 1024;
            spotLight.shadow.mapSize.height = 1024;
            scene.add(spotLight);


            pointLight1 = new THREE.PointLight(0xffffff);
            pointLight1.position.set(-14.867, 6.555, 7.006);
            pointLight1.distance = 10;
            pointLight1.intensity = 1;
            pointLight1.castShadow = true;
            scene.add(pointLight1);

            pointLight2 = new THREE.PointLight(0xffffff);
            pointLight2.position.set(-14.867, -6.555, 7.006);
            pointLight2.distance = 10;
            pointLight2.intensity = 1;
            pointLight2.castShadow = true;
            scene.add(pointLight2);

            pointLight3 = new THREE.PointLight(0xffffff);
            pointLight3.position.set(14.867, -6.555, 7.006);
            pointLight3.distance = 10;
            pointLight3.intensity = 1;
            pointLight3.castShadow = true;
            scene.add(pointLight3);

            pointLight4 = new THREE.PointLight(0xffffff);
            pointLight4.position.set(14.867, 6.555, 7.006);
            pointLight4.distance = 10;
            pointLight4.intensity = 1;
            pointLight4.castShadow = true;
            scene.add(pointLight4);



        }

        // backGround
        {
            // plane geometry which has the rule of backGround
            backGround = getSurface(1.3, 1);
            backGround.position.set(0, 0, 8.646);
            backGround.scale.set(25.025, 15.937, 1);
            backGround.receiveShadow = true;
            scene.add(backGround);

        }

    }

    function animate() {
        renderer.render(scene, camera);
        requestAnimationFrame(animate);

        // storing the current backGround Texture
        active_texture = backGround.material.map;

        // optional : light dance
        pointLight1.intensity = Math.sin(t / 500) * 2;
        pointLight2.intensity = Math.sin(t / 500) * 2;
        pointLight3.intensity = Math.sin(t / 500) * 2;
        pointLight4.intensity = Math.sin(t / 500) * 2;
    }

    function getSurface(width, height)
    {
        let geometry = new THREE.PlaneGeometry(width, height);

        let material = new THREE.MeshPhongMaterial({
            map: dragon_texture,
            side: THREE.DoubleSide
        });

        let mesh = new THREE.Mesh(geometry, material, 1);

        return mesh;
    }

    function changeBackGround(BG)
    {
        if (BG == 'Ying Yung'){
            active_texture.dispose();
            backGround.material.map = dragon_texture;
        }
        else if (BG == 'Wood'){
            active_texture.dispose();
            backGround.material.map = wood_texture;
        }
        else if (BG == 'Brick'){
            active_texture.dispose();
            backGround.material.map = brick_texture;
        }
        else if (BG == 'Bamboo'){
            active_texture.dispose();
            backGround.material.map = bambo_texture;
        }
        else if (BG == 'Cracked'){
            active_texture.dispose();
            backGround.material.map = cracked_texture;
        }
        else if (BG == 'Egyptian'){
            active_texture.dispose();
            backGround.material.map = egypt_texture;
        }
    }

    function createPanel()
    {
        var gui = new dat.GUI();

        parameters = {
            BG: "Ying Yung"
        }

        gui.add(parameters, 'BG', ["Ying Yung","Bamboo","Egyptian","Wood", "Brick", "Cracked"]).name('backGround').onChange(function () {
            changeBackGround(parameters.BG);
        });
        gui.open();
    }
</script>
</html>